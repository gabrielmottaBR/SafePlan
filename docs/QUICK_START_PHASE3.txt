"""
SafePlan Phase 3 - Quick Start Guide
Guia rÃ¡pido para comeÃ§ar a usar ML features
"""

# ============================================================================
# QUICK START: PHASE 3 ML INTEGRATION
# ============================================================================

# 1. INICIAR DASHBOARD
# ============================================================================
print("1ï¸âƒ£ Para iniciar o dashboard:")
print("   streamlit run app/main.py")
print("   â†’ Navegue para aba 'Predictions'")
print()

# 2. USAR ML ENGINE PROGRAMATICAMENTE
# ============================================================================
print("2ï¸âƒ£ Usar ML Engine no cÃ³digo:")
print()

# Exemplo 1: Detectar anomalias
example_1 = """
from src.ml.ml_engine import create_ml_engine

engine = create_ml_engine()

# Detectar anomalia em sensor 1
result = engine.detect_anomalies(sensor_id=1)

print(f"Status: {'ğŸš¨ ANOMALIA' if result['is_anomaly'] else 'âœ“ NORMAL'}")
print(f"Score: {result['anomaly_score']:.4f}")
print(f"Valor: {result['value']:.2f}")
"""
print("Exemplo 1 - Detectar Anomalias:")
print(example_1)
print()

# Exemplo 2: Fazer forecast
example_2 = """
from src.ml.ml_engine import create_ml_engine

engine = create_ml_engine()

# Forecast para prÃ³ximas 24 horas
result = engine.forecast_sensor(sensor_id=1, periods=24)

forecast = result['forecast']
metrics = result['metrics']

print(f"PrÃ³ximo valor: {forecast['forecasted_values'][0]:.2f}")
print(f"Intervalo: [{forecast['lower_bound'][0]:.2f}, {forecast['upper_bound'][0]:.2f}]")
print(f"MAPE: {metrics['mape']:.2f}%")
"""
print("Exemplo 2 - Fazer Forecast:")
print(example_2)
print()

# Exemplo 3: Treinar modelos
example_3 = """
from src.ml.ml_engine import create_ml_engine

engine = create_ml_engine()

# Treinar para um sensor
print("Treinando Anomaly Detector...")
success = engine.train_anomaly_detector(sensor_id=1)

print("Treinando Forecaster...")
success = engine.train_forecaster(sensor_id=1)

# Retreinar todos os modelos
print("Retraining todos os modelos...")
status = engine.retrain_all_models()
print(f"Resultado: {status}")
"""
print("Exemplo 3 - Treinar Modelos:")
print(example_3)
print()

# 3. TESTAR IMPLEMENTAÃ‡ÃƒO
# ============================================================================
print("3ï¸âƒ£ Para testar a implementaÃ§Ã£o:")
print("   pytest tests/unit/test_ml.py -v")
print()

# 4. WORKFLOWS RECOMENDADOS
# ============================================================================
print("4ï¸âƒ£ Workflows Recomendados:")
print()

workflow_1 = """
Workflow A - Monitor Anomalias
â”œâ”€ Abrir Dashboard â†’ Predictions â†’ Anomaly Detection
â”œâ”€ Selecionar sensor via dropdown
â”œâ”€ Ver status atual (Normal/Anomalia)
â”œâ”€ Ver score (0-1 range)
â”œâ”€ Ver grÃ¡fico com histÃ³rico
â””â”€ Investigar qualquer anomalia detectada
"""
print(workflow_1)

workflow_2 = """
Workflow B - Fazer Forecast
â”œâ”€ Abrir Dashboard â†’ Predictions â†’ Forecasting
â”œâ”€ Selecionar sensor
â”œâ”€ Ajustar horizonte (6-168 horas)
â”œâ”€ Ver forecast chart com intervalo de confianÃ§a (95%)
â”œâ”€ Verificar mÃ©tricas (MAPE, RMSE, MAE)
â””â”€ Monitorar que valores preditos nÃ£o ultrapassem threshold
"""
print(workflow_2)

workflow_3 = """
Workflow C - Treinar Modelos
â”œâ”€ Abrir Dashboard â†’ Predictions â†’ Training
â”œâ”€ Selecionar sensores para treino
â”œâ”€ Clicar "Treinar Modelos"
â”œâ”€ Aguardar progresso
â”œâ”€ Ver quantos foram treinados com sucesso
â””â”€ Verificar Model Status para cobertura
"""
print(workflow_3)

workflow_4 = """
Workflow D - IntegraÃ§Ã£o com Alerts
â”œâ”€ Usar detect_anomalies() em alerting pipeline
â”œâ”€ Se score > 0.8, criar alert de severidade 3 (Danger)
â”œâ”€ Integrar forecast com alert proativo
â”œâ”€ Se forecast > upper_critical_limit, alerta critical
â””â”€ Notificar Teams com anomalias/forecasts
"""
print(workflow_4)

# 5. REQUISITOS DE DADOS
# ============================================================================
print("5ï¸âƒ£ Requisitos de Dados:")
print()
requirements = """
Anomaly Detection:
â”œâ”€ MÃ­nimo: 30 amostras
â”œâ”€ Ideal: 168+ amostras (7 dias)
â””â”€ Qualidade: data_quality == 0

Time Series Forecasting:
â”œâ”€ MÃ­nimo: 50 amostras
â”œâ”€ Ideal: 500+ amostras
â””â”€ Qualidade: data_quality == 0
"""
print(requirements)

# 6. PRINCIPAIS CLASSES E FUNÃ‡Ã•ES
# ============================================================================
print("6ï¸âƒ£ Main Classes & Functions:")
print()
api = """
MLEngine
â”œâ”€ create_ml_engine()
â”œâ”€ detect_anomalies(sensor_id)
â”œâ”€ forecast_sensor(sensor_id, periods)
â”œâ”€ train_anomaly_detector(sensor_id, hours, contamination)
â”œâ”€ train_forecaster(sensor_id, hours)
â”œâ”€ retrain_all_models()
â”œâ”€ save_prediction(...)
â”œâ”€ get_predictions(sensor_id, model_type)
â””â”€ get_ml_status()

AnomalyDetector
â”œâ”€ fit(data)
â”œâ”€ detect_isolation_forest(data)
â”œâ”€ detect_lof(data)
â”œâ”€ detect_ensemble(data, threshold)
â”œâ”€ calculate_anomaly_threshold(data, percentile)
â””â”€ get_anomaly_summary(data)

TimeSeriesForecaster
â”œâ”€ fit(timestamps, values)
â”œâ”€ forecast(periods)
â”œâ”€ forecast_with_history(periods)
â”œâ”€ calculate_metrics()
â”œâ”€ forecast_summary(periods)
â””â”€ get_components()

PredictionRepository
â”œâ”€ create(sensor_id, model_type, ...)
â”œâ”€ find_by_sensor(sensor_id, model_type)
â”œâ”€ find_recent(sensor_id, model_type, hours)
â”œâ”€ find_anomalies(sensor_id)
â”œâ”€ get_latest(sensor_id, model_type)
â”œâ”€ get_statistics(sensor_id)
â””â”€ delete_old(days)
"""
print(api)

# 7. PRÃ“XIMOS PASSOS
# ============================================================================
print("7ï¸âƒ£ PrÃ³ximos Passos:")
print()
next_steps = """
â–¡ Testar Dashboard (abrir app e navegar para Predictions)
â–¡ Treinar modelos em alguns sensores
â–¡ Verificar Model Status para cobertura
â–¡ Executar testes unitÃ¡rios
â–¡ Ler documentaÃ§Ã£o completa (docs/PHASE3_ML_GUIDE.md)
â–¡ Integrar com alert engine
â–¡ Agendar retrein automÃ¡tico (Phase 5)
â–¡ Preparar para Phase 4 (Advanced UI & Reporting)
"""
print(next_steps)

# 8. DOCUMENTAÃ‡ÃƒO
# ============================================================================
print("8ï¸âƒ£ DocumentaÃ§Ã£o:")
print()
docs = """
â”œâ”€ docs/PHASE3_ML_GUIDE.md (30+ seÃ§Ãµes)
â”‚  â”œâ”€ Anomaly Detection guide
â”‚  â”œâ”€ Time Series Forecasting guide
â”‚  â”œâ”€ ML Engine usage
â”‚  â”œâ”€ Streamlit interface
â”‚  â””â”€ Troubleshooting
â”œâ”€ docs/PHASE3_IMPLEMENTATION_SUMMARY.md
â”‚  â”œâ”€ Componentes criados
â”‚  â”œâ”€ File statistics
â”‚  â”œâ”€ How to use
â”‚  â””â”€ Integration points
â””â”€ tests/unit/test_ml.py
   â”œâ”€ 19+ test cases
   â”œâ”€ AnomalyDetector tests
   â”œâ”€ TimeSeriesForecaster tests
   â””â”€ Edge case tests
"""
print(docs)

# 9. TROUBLESHOOTING RÃPIDO
# ============================================================================
print("9ï¸âƒ£ Troubleshooting RÃ¡pido:")
print()
troubleshoot = """
âŒ "Dados insuficientes"
   â†’ Sensor precisa 30+ leituras para anomaly, 50+ para forecast
   â†’ Aguardar mais dados serem coletados

âŒ MAPE/RMSE muito alto
   â†’ Coletar mais dados histÃ³ricos
   â†’ Verificar qualidade dos dados
   â†’ Retreinar modelo

âŒ Muitos falsos-positivos em anomalias
   â†’ Reduzir contamination (0.05 em vez de 0.1)
   â†’ Aumentar threshold (0.7 em vez de 0.5)

âŒ Models nÃ£o persistem apÃ³s restart
   â†’ Modelos ficam em memÃ³ria
   â†’ Treinar novamente apÃ³s restart
   â†’ Agendar retrein diÃ¡rio (Phase 5)

âŒ Memory leak com muitos sensores
   â†’ Limitar nÃºmero de sensores
   â†’ Fazer cleanup periodicamente
   â†’ Usar gc.collect()
"""
print(troubleshoot)

# 10. ARQUITETURA SIMPLIFICADA
# ============================================================================
print("ğŸ”Ÿ Arquitetura Simplificada:")
print()
arch = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Django Streamlit App                     â”‚
â”‚  (app/main.py com import de app/pages/predictions_page.py)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ML Engine  â”‚  â”‚ Sensor Mgr   â”‚
   â”‚ (ml_engine) â”‚  â”‚  (alert eng) â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                       â”‚
   â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Anomaly     â”‚  â”‚  Forecaster   â”‚
â”‚  Detector    â”‚  â”‚  (Prophet)    â”‚
â”‚ (ISO Forest) â”‚  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Database   â”‚
        â”‚ (SQLite)    â”‚
        â”‚  - Readings â”‚
        â”‚  - Predict. â”‚
        â”‚  - Alerts   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""
print(arch)

print("\n" + "="*70)
print("âœ… ImplementaÃ§Ã£o Phase 3 Completa!")
print("ğŸ“– Leia docs/PHASE3_ML_GUIDE.md para documentaÃ§Ã£o completa")
print("="*70)
